<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Game Portfolio ‚Äì Your Name</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050816;
      --bg2: #0b1120;
      --accent: #22d3ee;
      --accent2: #a855f7;
      --text: #e5e7eb;
      --danger: #f97373;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 55%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 16px;
    }

    .shell {
      width: 100%;
      max-width: 1200px;
      background: linear-gradient(135deg, #020617, #020617, #0b1120);
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 20px 60px rgba(15, 23, 42, 0.9);
      padding: 16px 16px 18px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      position: relative;
      overflow: hidden;
    }

    .shell::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: conic-gradient(
        from 220deg,
        rgba(56, 189, 248, 0.15),
        transparent,
        rgba(147, 51, 234, 0.25),
        transparent
      );
      filter: blur(40px);
      opacity: 0.5;
      z-index: -1;
      animation: spinGlow 20s linear infinite;
    }

    @keyframes spinGlow {
      to {
        transform: rotate(360deg);
      }
    }

    /* HEADER / HUD */
    .hud {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 14px;
      border-radius: 14px;
      background: linear-gradient(90deg, #020617, #020617, #111827);
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .hud-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .avatar {
      width: 46px;
      height: 46px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0%, #22d3ee, #0ea5e9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      box-shadow: 0 0 20px rgba(34, 211, 238, 0.7);
    }

    .hud-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .hud-name {
      font-weight: 700;
      letter-spacing: 0.03em;
      font-size: 18px;
    }

    .hud-role {
      font-size: 12px;
      opacity: 0.7;
    }

    .hud-right {
      display: flex;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .pill {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.5);
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .pill span:first-child {
      font-size: 14px;
    }

    .xp-bar-wrap {
      display: flex;
      flex-direction: column;
      gap: 3px;
      min-width: 170px;
    }

    .xp-label {
      font-size: 11px;
      display: flex;
      justify-content: space-between;
      opacity: 0.8;
    }

    .xp-track {
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      overflow: hidden;
      position: relative;
    }

    .xp-fill {
      position: absolute;
      inset: 0;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #22d3ee, #a855f7);
      box-shadow: 0 0 12px rgba(56, 189, 248, 0.7);
      transition: width 0.5s ease-out;
    }

    /* MAIN LAYOUT */
    .main {
      display: grid;
      grid-template-columns: minmax(0, 0.95fr) minmax(0, 1.1fr);
      gap: 14px;
      margin-top: 4px;
      min-height: 420px;
    }

    @media (max-width: 900px) {
      .main {
        grid-template-columns: 1fr;
      }
    }

    /* LEFT: MAP */
    .map-card {
      border-radius: 14px;
      padding: 12px;
      background: radial-gradient(circle at top, #020617 0, #020617 30%, #020617);
      border: 1px solid rgba(148, 163, 184, 0.6);
      box-shadow: inset 0 0 25px rgba(15, 23, 42, 0.95);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .map-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      opacity: 0.85;
    }

    .map-grid {
      margin-top: 4px;
      flex: 1;
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      grid-template-rows: repeat(3, minmax(0, 70px));
      gap: 10px;
      position: relative;
    }

    .node {
      position: relative;
      border-radius: 14px;
      background: radial-gradient(circle at 30% 0%, #0f172a, #020617);
      border: 1px solid rgba(148, 163, 184, 0.7);
      box-shadow: 0 12px 24px rgba(15, 23, 42, 0.9);
      cursor: pointer;
      padding: 8px 9px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      overflow: hidden;
      transition: transform 0.18s ease, box-shadow 0.18s ease,
        border-color 0.18s ease, background 0.18s ease;
    }

    .node:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 26px rgba(15, 23, 42, 1),
        0 0 16px rgba(56, 189, 248, 0.1);
      border-color: rgba(56, 189, 248, 0.9);
    }

    .node.locked {
      border-style: dashed;
      border-color: rgba(148, 163, 184, 0.4);
      opacity: 0.65;
      cursor: not-allowed;
    }

    .node.locked::after {
      content: "LOCKED";
      position: absolute;
      bottom: 4px;
      right: 6px;
      font-size: 9px;
      letter-spacing: 0.12em;
      opacity: 0.6;
    }

    .node.active {
      border-color: var(--accent);
      box-shadow: 0 0 18px rgba(56, 189, 248, 0.7);
      background: radial-gradient(circle at 0 0, #22d3ee33, #020617);
    }

    .node-visited:not(.active) {
      border-color: rgba(34, 197, 94, 0.7);
    }

    .node-title {
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .node-chip {
      font-size: 10px;
      opacity: 0.7;
    }

    .node-level {
      font-size: 11px;
      opacity: 0.8;
    }

    .node-icon {
      font-size: 17px;
    }

    /* PLAYER MARKER */
    .player {
      position: absolute;
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0%, #22c55e, #16a34a);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      box-shadow: 0 0 16px rgba(34, 197, 94, 0.85);
      transform: translate(-50%, -50%);
      transition: top 0.3s ease-out, left 0.3s ease-out;
      pointer-events: none;
      z-index: 5;
    }

    /* RIGHT: PANEL */
    .panel-card {
      border-radius: 14px;
      padding: 12px;
      background: radial-gradient(circle at 0 0, #0f172a, #020617);
      border: 1px solid rgba(148, 163, 184, 0.6);
      box-shadow: inset 0 0 24px rgba(15, 23, 42, 0.95);
      display: flex;
      flex-direction: column;
      gap: 8px;
      position: relative;
      overflow: hidden;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .panel-title {
      font-size: 17px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-badge {
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.7);
    }

    .panel-body {
      margin-top: 4px;
      font-size: 13px;
      line-height: 1.5;
      max-height: 360px;
      overflow: auto;
      padding-right: 4px;
    }

    .panel-body::-webkit-scrollbar {
      width: 6px;
    }
    .panel-body::-webkit-scrollbar-track {
      background: transparent;
    }
    .panel-body::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.5);
      border-radius: 999px;
    }

    .section-label {
      text-transform: uppercase;
      font-size: 10px;
      opacity: 0.55;
      letter-spacing: 0.18em;
      margin-top: 8px;
      margin-bottom: 4px;
    }

    .tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 3px;
    }

    .tag {
      font-size: 11px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      background: rgba(15, 23, 42, 0.85);
    }

    .link-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }

    .btn-link {
      border-radius: 999px;
      padding: 5px 10px;
      font-size: 11px;
      border: 1px solid rgba(56, 189, 248, 0.7);
      background: radial-gradient(circle at 0 0, #0f172a, #020617);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      text-decoration: none;
      color: var(--text);
      cursor: pointer;
      transition: transform 0.18s ease, box-shadow 0.18s ease,
        border-color 0.18s ease;
    }

    .btn-link:hover {
      transform: translateY(-1px);
      box-shadow: 0 0 16px rgba(56, 189, 248, 0.45);
      border-color: rgba(56, 189, 248, 0.95);
    }

    .bullet-list {
      list-style: none;
      margin-top: 4px;
    }
    .bullet-list li {
      position: relative;
      padding-left: 16px;
      margin-bottom: 3px;
      font-size: 13px;
      opacity: 0.9;
    }
    .bullet-list li::before {
      content: "‚Ä¢";
      position: absolute;
      left: 4px;
      top: 0;
      opacity: 0.7;
    }

    /* FOOTER / ACHIEVEMENTS */
    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      opacity: 0.75;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 2px;
    }

    .achievements {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .badge {
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 10px;
    }

    .badge--unlocked {
      border-color: rgba(34, 197, 94, 0.9);
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.55);
    }

    .hint {
      font-size: 10px;
      opacity: 0.7;
    }

    @media (max-width: 600px) {
      .hud {
        flex-direction: column;
        align-items: flex-start;
      }
      .hud-right {
        justify-content: flex-start;
      }
    }
  </style>
</head>
<body>
<div class="shell">
  <!-- HUD -->
  <header class="hud">
    <div class="hud-left">
      <div class="avatar">üöÄ</div>
      <div class="hud-main">
        <div class="hud-name">Your Name</div>
        <div class="hud-role">Fullstack / Frontend Web Developer</div>
      </div>
    </div>

    <div class="hud-right">
      <div class="pill">
        <span>‚≠ê</span>
        <span>LV.<span id="hud-level">1</span> Explorer</span>
      </div>
      <div class="pill">
        <span>üïπÔ∏è</span>
        <span id="hud-nodes">Visited: 0 / 5</span>
      </div>
      <div class="xp-bar-wrap">
        <div class="xp-label">
          <span>XP</span>
          <span id="hud-xp-text">0 / 500</span>
        </div>
        <div class="xp-track">
          <div class="xp-fill" id="xp-fill"></div>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="main">
    <!-- LEFT: MAP -->
    <section class="map-card">
      <div class="map-header">
        <span>WORLD MAP</span>
        <span style="font-size: 11px; opacity: 0.7;">Click a node to travel</span>
      </div>
      <div class="map-grid" id="map-grid">
        <!-- Nodes (positions arbitrary, tapi 5 node utama) -->
        <div class="node" data-id="home">
          <div class="node-title">
            <span class="node-icon">üè†</span>
            <span>Home / Intro</span>
          </div>
          <div class="node-level">LV.1</div>
          <div class="node-chip">Start here</div>
        </div>

        <div class="node" data-id="skills">
          <div class="node-title">
            <span class="node-icon">üõ†Ô∏è</span>
            <span>Skills</span>
          </div>
          <div class="node-level">LV.2</div>
          <div class="node-chip">Tech tree</div>
        </div>

        <div class="node" data-id="projects">
          <div class="node-title">
            <span class="node-icon">üì¶</span>
            <span>Projects</span>
          </div>
          <div class="node-level">LV.3</div>
          <div class="node-chip">Quest log</div>
        </div>

        <div class="node" data-id="experience">
          <div class="node-title">
            <span class="node-icon">üìú</span>
            <span>Experience</span>
          </div>
          <div class="node-level">LV.4</div>
          <div class="node-chip">Battle history</div>
        </div>

        <div class="node" data-id="contact">
          <div class="node-title">
            <span class="node-icon">üì°</span>
            <span>Contact</span>
          </div>
          <div class="node-level">LV.5</div>
          <div class="node-chip">Summon</div>
        </div>

        <div class="node locked" data-id="secret">
          <div class="node-title">
            <span class="node-icon">‚ùì</span>
            <span>Secret Room</span>
          </div>
          <div class="node-level">LV.?</div>
          <div class="node-chip">Unlock all first</div>
        </div>

        <!-- Empty grid cells for layout spacing -->
        <div></div>
        <div></div>
        <div></div>

        <!-- Player marker (absolute) -->
        <div class="player" id="player">üßç</div>
      </div>
    </section>

    <!-- RIGHT: PANEL -->
    <section class="panel-card">
      <div class="panel-header">
        <div class="panel-title">
          <span id="panel-icon">üè†</span>
          <span id="panel-title">Welcome</span>
        </div>
        <div class="panel-badge" id="panel-badge">Intro</div>
      </div>
      <div class="panel-body" id="panel-body">
        <p>
          Selamat datang di <strong>Game-Style Portfolio</strong>.  
          Gunakan mouse untuk meng-klik node di map kiri dan ‚Äújelajahi‚Äù setiap
          area untuk mengenal profil kamu.
        </p>
        <p style="margin-top:6px;">
          Kamu bisa ubah semua teks ini menjadi CV asli:
        </p>
        <ul class="bullet-list">
          <li>Ganti nama, role, dan level di bagian HUD atas.</li>
          <li>Isi section <em>Skills</em> dengan stack yang kamu pakai.</li>
          <li>Isi section <em>Projects</em> dengan project beneran (link GitHub/dll).</li>
          <li>Isi <em>Experience</em> &amp; <em>Education</em> sesuai riwayat kamu.</li>
          <li>Isi <em>Contact</em> dengan email &amp; sosial media.</li>
        </ul>
        <p class="section-label">TIP</p>
        <p style="font-size:12px; opacity:0.8;">
          Semua progress (XP, visited node, achievement) disimpan di <code>localStorage</code>,
          jadi kalau halaman di-refresh, data tetap ada di browser yang sama.
        </p>
      </div>
    </section>
  </main>

  <!-- FOOTER / ACHIEVEMENTS -->
  <footer class="footer">
    <div class="achievements">
      <div class="badge" id="badge-explorer">
        üß≠ Explorer
      </div>
      <div class="badge" id="badge-completionist">
        üèÖ Completionist
      </div>
      <div class="badge" id="badge-speedrunner">
        ‚è±Ô∏è Speedrunner
      </div>
    </div>
    <div class="hint">
      Hint: unlock Secret Room dengan mengunjungi semua node utama.
    </div>
  </footer>
</div>

<script>
  // -------- CONFIG DATA --------
  const NODES = {
    home: {
      icon: "üè†",
      title: "Home / Intro",
      badge: "Intro",
      xpReward: 60,
      content: `
        <p>
          Halo! Nama saya <strong>Your Name</strong>, seorang
          <strong>Web Developer</strong> yang fokus di
          <strong>HTML, CSS, dan JavaScript</strong> serta stack seperti
          <strong>Django / Flask</strong>.
        </p>
        <p style="margin-top:6px;">
          Portfolio ini dikemas seperti game: setiap section adalah "level"
          yang bisa kamu jelajahi.
        </p>
        <p class="section-label">PROFILE SNAPSHOT</p>
        <ul class="bullet-list">
          <li>Suka bikin aplikasi web interaktif &amp; game kecil berbasis browser.</li>
          <li>Sering eksperimen dengan UI/UX bertema cyberpunk / neon.</li>
          <li>Terbiasa kerja end-to-end: dari desain database sampai deployment.</li>
        </ul>
      `,
    },
    skills: {
      icon: "üõ†Ô∏è",
      title: "Skills & Tech Tree",
      badge: "Skills",
      xpReward: 80,
      content: `
        <p>
          Berikut skill utama yang sering digunakan. Silakan ganti sesuai profilmu.
        </p>
        <p class="section-label">CORE STACK</p>
        <div class="tag-row">
          <span class="tag">HTML5</span>
          <span class="tag">CSS3 / Tailwind</span>
          <span class="tag">JavaScript (ES6+)</span>
          <span class="tag">Responsive Design</span>
        </div>
        <p class="section-label">BACKEND / TOOLS</p>
        <div class="tag-row">
          <span class="tag">Python</span>
          <span class="tag">Django</span>
          <span class="tag">Flask</span>
          <span class="tag">REST API</span>
          <span class="tag">Git &amp; GitHub</span>
        </div>
        <p class="section-label">INTERESTS</p>
        <div class="tag-row">
          <span class="tag">Typing Games</span>
          <span class="tag">Machine Learning</span>
          <span class="tag">Data Visualization</span>
        </div>
      `,
    },
    projects: {
      icon: "üì¶",
      title: "Projects / Quest Log",
      badge: "Projects",
      xpReward: 110,
      content: `
        <p>
          Beberapa proyek yang bisa kamu tunjukkan. Ganti judul, deskripsi, dan URL dengan punyamu.
        </p>

        <p class="section-label">PROJECT 1</p>
        <p><strong>TypeRacer 3D</strong> ‚Äì Game typing speed dengan race, combo, dan power-up.</p>
        <ul class="bullet-list">
          <li>Pure HTML/CSS/JS tanpa backend.</li>
          <li>Fitur difficulty, power-ups, dan efek visual neon.</li>
        </ul>
        <div class="link-row">
          <a class="btn-link" href="#" target="_blank" rel="noopener">
            üîó Live Demo
          </a>
          <a class="btn-link" href="#" target="_blank" rel="noopener">
            üíª GitHub
          </a>
        </div>

        <p class="section-label">PROJECT 2</p>
        <p><strong>Koperasi Sekolah</strong> ‚Äì Sistem manajemen koperasi sekolah berbasis web.</p>
        <ul class="bullet-list">
          <li>CRUD barang, transaksi, laporan sederhana.</li>
          <li>Dibangun dengan Django / Flask (ganti sesuai real).</li>
        </ul>

        <p class="section-label">PROJECT 3</p>
        <p><strong>Tourism Recommender</strong> ‚Äì Rekomendasi pantai / wisata dengan filter.</p>
        <ul class="bullet-list">
          <li>Pencarian destinasi, filter jarak/biaya, UI responsive.</li>
        </ul>
      `,
    },
    experience: {
      icon: "üìú",
      title: "Experience & Education",
      badge: "History",
      xpReward: 120,
      content: `
        <p>
          Ringkasan pengalaman dan pendidikan. Sesuaikan dengan riwayatmu.
        </p>
        <p class="section-label">EXPERIENCE</p>
        <ul class="bullet-list">
          <li><strong>Freelance / Personal Projects</strong> ‚Äì Membangun beberapa aplikasi web (cooperative system, ride-sharing mockup, dsb.).</li>
          <li>Mengerjakan fullstack: auth, database, UI, sampai deploy.</li>
        </ul>
        <p class="section-label">EDUCATION</p>
        <ul class="bullet-list">
          <li><strong>Student / Fresh Graduate</strong> ‚Äì Fokus di Web Development &amp; Software Engineering.</li>
          <li>Mengerjakan banyak proyek tugas besar dengan Django/Flask.</li>
        </ul>
      `,
    },
    contact: {
      icon: "üì°",
      title: "Contact & Socials",
      badge: "Summon",
      xpReward: 80,
      content: `
        <p>
          Cara terbaik untuk menghubungi saya dan melihat lebih banyak karya.
        </p>
        <p class="section-label">CONTACT</p>
        <ul class="bullet-list">
          <li><strong>Email:</strong> your.email@example.com</li>
        </ul>
        <p class="section-label">SOCIALS</p>
        <div class="link-row">
          <a class="btn-link" href="#" target="_blank" rel="noopener">
            üêô GitHub
          </a>
          <a class="btn-link" href="#" target="_blank" rel="noopener">
            üíº LinkedIn
          </a>
          <a class="btn-link" href="#" target="_blank" rel="noopener">
            üåê Personal Website
          </a>
        </div>
      `,
    },
    secret: {
      icon: "üéÆ",
      title: "Secret Room",
      badge: "Easter Egg",
      xpReward: 150,
      content: `
        <p>
          Selamat! Kamu sudah membuka <strong>Secret Room</strong>.
        </p>
        <p style="margin-top:6px;">
          Di sini kamu bisa menaruh hal yang lebih personal:
        </p>
        <ul class="bullet-list">
          <li>Fun facts tentang kamu.</li>
          <li>Hobi, game favorit, musik, atau hal lain.</li>
          <li>Roadmap skill / project yang ingin kamu buat ke depan.</li>
        </ul>
        <p class="section-label">FUN FACT</p>
        <p style="font-size:13px; opacity:0.9;">
          Kamu bisa jadikan halaman ini sebagai "signature" unik saat kirim CV ke perusahaan.
        </p>
      `,
    },
  };

  const MAIN_NODE_IDS = ["home", "skills", "projects", "experience", "contact"];

  // -------- STATE & STORAGE --------
  const STORAGE_KEY = "game_portfolio_state_v1";

  let state = {
    xp: 0,
    level: 1,
    visited: {}, // {nodeId: true}
    firstVisitTime: null,
    lastVisitTime: null,
  };

  function loadState() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        const parsed = JSON.parse(raw);
        state = { ...state, ...parsed };
      }
    } catch (e) {
      console.warn("Failed to load state", e);
    }
  }

  function saveState() {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    } catch (e) {
      console.warn("Failed to save state", e);
    }
  }

  // -------- DOM REF --------
  const playerEl = document.getElementById("player");
  const mapGrid = document.getElementById("map-grid");
  const nodeEls = Array.from(mapGrid.querySelectorAll(".node"));
  const panelIcon = document.getElementById("panel-icon");
  const panelTitle = document.getElementById("panel-title");
  const panelBadge = document.getElementById("panel-badge");
  const panelBody = document.getElementById("panel-body");

  const xpFill = document.getElementById("xp-fill");
  const hudLevel = document.getElementById("hud-level");
  const hudXpText = document.getElementById("hud-xp-text");
  const hudNodes = document.getElementById("hud-nodes");

  const badgeExplorer = document.getElementById("badge-explorer");
  const badgeCompletionist = document.getElementById("badge-completionist");
  const badgeSpeedrunner = document.getElementById("badge-speedrunner");

  let currentNodeId = "home";

  // -------- INIT --------
  loadState();
  initMap();
  travelTo(currentNodeId, { initial: true });
  updateHud();
  updateAchievements();

  // -------- FUNCTIONS --------
  function initMap() {
    nodeEls.forEach((el) => {
      const id = el.dataset.id;
      if (state.visited[id]) {
        el.classList.add("node-visited");
      }
      if (id === currentNodeId) {
        el.classList.add("active");
        positionPlayerOnNode(el, true);
      }
      el.addEventListener("click", () => onNodeClick(id, el));
    });
    updateLockedState();
  }

  function onNodeClick(id, el) {
    const isLocked = el.classList.contains("locked");
    if (isLocked) return;
    if (id === currentNodeId) return;

    travelTo(id, { initial: false });
  }

  function travelTo(id, { initial }) {
    const nodeData = NODES[id];
    const nodeEl = nodeEls.find((n) => n.dataset.id === id);
    if (!nodeEl || !nodeData) return;

    currentNodeId = id;

    // Update node classes
    nodeEls.forEach((el) => el.classList.remove("active"));
    nodeEl.classList.add("active");

    // Move player
    positionPlayerOnNode(nodeEl, initial);

    // Update panel
    panelIcon.textContent = nodeData.icon;
    panelTitle.textContent = nodeData.title;
    panelBadge.textContent = nodeData.badge;
    panelBody.innerHTML = nodeData.content;

    // XP & visited
    const firstTimeVisit = !state.visited[id];
    const now = Date.now();
    if (!state.firstVisitTime) state.firstVisitTime = now;
    state.lastVisitTime = now;

    state.visited[id] = true;
    if (firstTimeVisit) {
      state.xp += nodeData.xpReward || 50;
      // Level up sederhana: tiap 500 XP naik 1 level
      state.level = 1 + Math.floor(state.xp / 500);
    }

    updateLockedState();
    updateHud();
    updateAchievements();
    saveState();
  }

  function positionPlayerOnNode(nodeEl, instant) {
    const rect = nodeEl.getBoundingClientRect();
    const gridRect = mapGrid.getBoundingClientRect();
    // center of node relative to grid
    const top = rect.top - gridRect.top + rect.height / 2;
    const left = rect.left - gridRect.left + rect.width / 2;

    if (instant) {
      playerEl.style.transition = "none";
      playerEl.style.top = `${top}px`;
      playerEl.style.left = `${left}px`;
      // force reflow
      void playerEl.offsetWidth;
      playerEl.style.transition = "top 0.3s ease-out, left 0.3s ease-out";
    } else {
      playerEl.style.top = `${top}px`;
      playerEl.style.left = `${left}px`;
    }
  }

  function updateLockedState() {
    const allMainVisited = MAIN_NODE_IDS.every((id) => !!state.visited[id]);
    const secretNode = nodeEls.find((n) => n.dataset.id === "secret");
    if (!secretNode) return;
    if (allMainVisited) {
      secretNode.classList.remove("locked");
    } else {
      secretNode.classList.add("locked");
    }
  }

  function updateHud() {
    // XP & level text
    const xpInLevel = state.xp % 500;
    const xpNeeded = 500;
    const percent = Math.min(100, (xpInLevel / xpNeeded) * 100);
    xpFill.style.width = `${percent}%`;

    hudLevel.textContent = state.level;
    hudXpText.textContent = `${xpInLevel} / ${xpNeeded}`;

    const visitedCount = Object.keys(state.visited).length;
    const totalMain = MAIN_NODE_IDS.length + 1; // +secret
    hudNodes.textContent = `Visited: ${visitedCount} / ${totalMain}`;
  }

  function updateAchievements() {
    const visitedIds = Object.keys(state.visited);

    // Explorer: minimal 3 node visited
    if (visitedIds.length >= 3) {
      badgeExplorer.classList.add("badge--unlocked");
    }

    // Completionist: semua termasuk secret
    const allNodes = ["home", "skills", "projects", "experience", "contact", "secret"];
    const isCompletionist = allNodes.every((id) => state.visited[id]);
    if (isCompletionist) {
      badgeCompletionist.classList.add("badge--unlocked");
    }

    // Speedrunner: kunjungi semua main node dalam <= 5 menit sejak firstVisit
    if (state.firstVisitTime && state.lastVisitTime) {
      const diffMs = state.lastVisitTime - state.firstVisitTime;
      const diffMin = diffMs / 1000 / 60;
      const allMainVisited = MAIN_NODE_IDS.every((id) => state.visited[id]);
      if (allMainVisited && diffMin <= 5) {
        badgeSpeedrunner.classList.add("badge--unlocked");
      }
    }
  }

  // Responsif: reposition player on resize
  window.addEventListener("resize", () => {
    const currentNodeEl = nodeEls.find((n) => n.dataset.id === currentNodeId);
    if (currentNodeEl) {
      positionPlayerOnNode(currentNodeEl, true);
    }
  });
</script>
</body>
</html>
